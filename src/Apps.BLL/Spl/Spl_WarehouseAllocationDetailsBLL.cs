//------------------------------------------------------------------------------
// <auto-generated>
//     此代码已从模板生成。
//
//     手动更改此文件可能导致应用程序出现意外的行为。
//     如果重新生成代码，将覆盖对此文件的手动更改。
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Collections.Generic;
using System.Linq;
using Apps.Models;
using Apps.Common;
using Unity.Attributes;
using System.Transactions;
using Apps.BLL.Core;
using Apps.Locale;
using Apps.IDAL.Spl;
using Apps.Models.Spl;
using Apps.IBLL.Spl;
namespace Apps.BLL.Spl
{

    public partial class Spl_WarehouseAllocationDetailsBLL
    {

        //获取单据详情列表
        public List<Spl_WarehouseAllocationDetailsModel> GetList(ref GridPager pager, string queryStr, string warrantId)
        {

            IQueryable<Spl_WarehouseAllocationDetails> queryData = null;
            if (!string.IsNullOrWhiteSpace(queryStr))
            {
                queryData = m_Rep.GetList(
                                a => (a.Id.Contains(queryStr)
                                || a.WareDetailsId.Contains(queryStr)
                                || a.WarehouseId.Contains(queryStr)
                                || a.WarehouseAllocationId.Contains(queryStr)
                                || a.Defined.Contains(queryStr)) && a.WarehouseAllocationId == warrantId

                                );
            }
            else
            {
                queryData = m_Rep.GetList(a => a.WarehouseAllocationId == warrantId);
            }
            pager.totalRows = queryData.Count();
            //排序
            queryData = LinqHelper.SortingAndPaging(queryData, pager.sort, pager.order, pager.page, pager.rows);
            return CreateModelList(ref queryData);
        }
        public override List<Spl_WarehouseAllocationDetailsModel> CreateModelList(ref IQueryable<Spl_WarehouseAllocationDetails> queryData)
        {

            List<Spl_WarehouseAllocationDetailsModel> modelList = (from r in queryData
                                                                select new Spl_WarehouseAllocationDetailsModel
                                                                {
                                                                    Id = r.Id,
                                                                    WareDetailsId = r.WareDetailsId,
                                                                    WareDetailsName = r.Spl_WareDetails.Name,
                                                                    WarehouseId = r.WarehouseId,
                                                                    WarehouseName = r.Spl_Warehouse.Name,
                                                                    WarehouseAllocationId = r.WarehouseAllocationId,
                                                                    Quantity = r.Quantity,
                                                                    Price = r.Price,
                                                                    TotalPrice = r.TotalPrice,
                                                                    Defined = r.Defined,
                                                                    CreateTime = r.CreateTime,
                                                                    WareDetailsCode = r.Spl_WareDetails.Code,
                                                                    WareDetailsUnit = r.Spl_WareDetails.Unit,
                                                                    WareDetailsCategory = r.Spl_WareDetails.Spl_WareCategory.Name,
                                                                    WareDetailsVender = r.Spl_WareDetails.Vender,
                                                                    WareDetailsBrand = r.Spl_WareDetails.Brand,
                                                                    WareDetailsSize = r.Spl_WareDetails.Size
                                                                }).ToList();

            return modelList;
        }

 

    }
}
